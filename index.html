<!DOCTYPE html>
<html lang="en">
    <head>
        <script src="./js/consts.js"></script>
        <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
        <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
        <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="./js/cv.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

        <title>Michael O'Donnell - CV</title>
    </head>

    <body class="bg-light container">
        <div id="app" class="container-fluid">
        </div>

        <script type="text/babel">        

            function PersonalDetailsCard(props) {

                return(  
                    <div class="col-6 my-5">                 
                        <div class="card">
                                <div class="card-header">
                                    Michael O'Donnell
                                </div>
                            <div class="row">
                            <div class="col-12 col-lg-6">
                                <img src="./media/img/me.jpg" class="card-img" alt="..." />
                            </div>
                            <div class="col-12 col-lg-6">
                                <div class="card-body">
                                    <h5 class="card-title">Cool Guy</h5>
                                    <p class="card-text">email me!</p>
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>);
            }
            
            function Menu (props) {

                const menu_items = [];

                React.useEffect(() => {
                    if (props.state.menu.length == 0) {
                        fetch(`${webroot}/get_entry_types`)
                        .then(response => response.json())
                        .then(function(data) {
                            props.setter({
                                ...props.state,
                                menu: data
                            });
                        });
                    }
                })

                function nav_click (event) {
                    const type = event.target.dataset.type;
                    if (type != "menu") {
                        props.setter({
                            ...props.state,
                            content_type: type
                        });
                        console.log(type);
                    } else {
                        props.setter({
                            ...props.state,
                            content_type: "menu"
                        });
                        console.log(type);
                    }
                }      

                for (var key in props.state.menu) {
                    menu_items.push(
                        <li className="nav-item">
                            <a className={props.state.menu[key].type == props.state.content_type ? "nav-link active" : "nav-link"} aria-current="page" data-bs-toggle="collapse" data-bs-target=".navbar-collapse.show" data-type={`${props.state.menu[key].type}`} href="#" onClick={nav_click}>{props.state.menu[key].type}</a>
                        </li>
                    )
                }

                return (
                    <nav className={props.state.content_type == "menu" ? "navbar navbar-light col-4" : "navbar navbar-expand-md navbar-light"}>
                        <div className={props.state.content_type == "menu" ? "container-fluid justify-content-end" : "container-fluid"}>
                            { props.state.content_type != "menu" ? <a className="navbar-brand" data-type="menu" href="#" onClick={nav_click}>Michael O'Donnell</a> : ""}
                            { props.state.content_type != "menu" ? <button className="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"> 
                            <span className="navbar-toggler-icon"></span> 
                            </button> : "" }
                            <div className={ props.state.content_type != "menu" ? "collapse navbar-collapse" : "" } id="navbarSupportedContent">
                                <ul className={ props.state.content_type == "menu" ? "navbar-nav flex-column" : "navbar-nav me-auto mb-2 mb-lg-0"}>
                                    {menu_items}
                                </ul>
                            </div>
                        </div>
                    </nav>);
                
            }

            function CVContent (props) {

                const [entries, setEntries] = React.useState(null);
                const entry_cards = [];

                React.useEffect(() => {
                    if (props.content_type != "menu") {
                        console.log("looking at something else, getting content...");
                        fetch(`${webroot}/get_cv_entries?type=${props.content_type}`)
                        .then(response => response.json())
                        .then(function(data) {
                            setEntries(data)
                        });
                    }else{
                        console.log("Looking at the menu, no content fetching...");
                    }
                },[props.content_type]);
                    

                for (var key in entries) {
                    entry_cards.push(
                        <div class="card mb-2">
                        <div class="card-header">
                            {entries[key].start} - {entries[key].end == null ? "Present" : entries[key].end}
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">{entries[key].title}</h5>
                            <p class="card-text">{entries[key].description}</p>
                        </div>
                        </div>
                    )
                }

                return (
                    <div className="container">
                        {props.content_type != "menu" ? entry_cards : ""}
                    </div>
                );
            }

            function App(props) {

                const [state, setState] = React.useState({
                    content_type: "menu", 
                    menu: []
                });
                

                return (
                    <div className={state.content_type == "menu" ? "row" : ""}>
                        <Menu state={state} setter={setState} />
                        {state.content_type != "menu" ? <div id="cv-cont"><CVContent content_type={state.content_type} /> </div>: <PersonalDetailsCard  state={state} setter={setState} /> }
                    </div>
                );
            }

            ReactDOM.render(<App />, document.querySelector("#app"));

        </script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
    </body>

</html>