<!DOCTYPE html>
<html lang="en">
    <head>
        <script src="./js/consts.js"></script>
        <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
        <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
        <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="./js/cv.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

        <title>Michael O'Donnell - CV</title>
    </head>

    <body>
        <div id="app">
        </div>

        <script type="text/babel">
            
            function Nav (props) {

                const menu_items = [];

                React.useEffect(() => {
                    if (props.state.menu.length == 0) {
                        fetch(`http://127.0.0.1:8000/get_entry_types`)
                        .then(response => response.json())
                        .then(function(data) {
                            props.setter({
                                ...props.state,
                                menu: data
                            });
                        });
                    }
                })

                function nav_click (event) {
                    const type = event.target.dataset.type;
                    if (type != "Main") {
                        props.setter({
                            ...props.state,
                            content_type: type
                        });
                        console.log(type);
                    } else {
                        props.setter({
                            ...props.state,
                            content_type: "menu"
                        });
                        console.log(type);
                    }
                }      

                menu_items.push(
                    <li className="nav-item">
                        <a className="nav-link active" aria-current="page" data-type="Main" href="#" onClick={nav_click}>Main</a>
                    </li>
                )         

                for (var key in props.state.menu) {
                    menu_items.push(
                        <li className="nav-item">
                            <a className="nav-link active" aria-current="page" data-type={`${props.state.menu[key].type}`} href="#" onClick={nav_click}>{props.state.menu[key].type}</a>
                        </li>
                    )
                }

                return (
                    <ul className={props.state.content_type == "menu" ? "nav flex-column" : "nav"}>
                        {menu_items}
                    </ul>
                );
            }

            function CVContent (props) {

                const [entries, setEntries] = React.useState(null);
                const entry_cards = [];

                React.useEffect(() => {
                    if (props.content_type != "menu") {
                        console.log("looking at something else, getting content...");
                        fetch(`http://127.0.0.1:8000/get_cv_entries?type=${props.content_type}`)
                        .then(response => response.json())
                        .then(function(data) {
                            setEntries(data)
                        });
                    }else{
                        console.log("Looking at the menu, no content fetching...");
                    }
                },[props.content_type]);
                    

                for (var key in entries) {
                    entry_cards.push(
                        <div class="card">
                        <div class="card-header">
                            {entries[key].title}
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">{entries[key].start}</h5>
                            <p class="card-text">{entries[key].description}</p>
                        </div>
                        </div>
                    )
                    console.log(entries[key]);
                }

                return (
                    <div className="row">
                        {entry_cards}
                    </div>
                );
            }

            function App(props) {

                const [state, setState] = React.useState({
                    content_type: "menu", 
                    menu: []
                });
                

                return (
                    <div>
                        <Nav state={state} setter={setState} />
                        <CVContent content_type={state.content_type} />
                    </div>
                );
            }

            ReactDOM.render(<App />, document.querySelector("#app"));

        </script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
    </body>

</html>